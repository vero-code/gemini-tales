<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Course - AI Course Creator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="course-page">
    <div class="course-container">
        <header class="course-header">
            <a href="/" class="back-link">‚Üê Create Another Course</a>
            <div class="logo">üéì AI Course Creator</div>
        </header>
        <div class="course-layout">
            <aside class="course-sidebar">
                <div class="toc-title">Contents</div>
                <nav>
                    <ul id="toc-list" class="toc-list">
                        <!-- TOC items will be injected here -->
                    </ul>
                </nav>
            </aside>
            <main class="course-main">
                <article id="course-content" class="course-content">
                    <div class="loading-course">Loading your course...</div>
                </article>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Debug logic: use sample data if ?debug=true is in URL or no data exists
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('debug') === 'true') {
                localStorage.setItem('currentCourse', '# Magical Debug Mode\n\n## Chapter 1: Layout Test\nThis is a demonstration text. It allows you to quickly adjust CSS and HTML right now.\n\n## Chapter 2: Search Suggestions\nBelow you can see how Google Search links look when there are many of them and they need to wrap to the next line.');
                localStorage.setItem('renderedContent', `
                    <div class="container">
                        <div class="headline" style="display:flex; align-items:center; gap:8px;">
                            <img src="https://www.google.com/favicon.ico" width="16"> 
                            <span class="headline-label">Search suggestions</span>
                        </div>
                        <div class="carousel">
                            <div class="chip">Pirate Treasures</div>
                            <div class="chip">Sea Legends</div>
                            <div class="chip">How to find treasure</div>
                            <div class="chip">Treasure Island Map</div>
                            <div class="chip">Captain Adventures</div>
                            <div class="chip">Ocean Mysteries</div>
                            <div class="chip">Golden Coast</div>
                        </div>
                    </div>
                `);
            }

            const courseData = localStorage.getItem('currentCourse');
            const renderedContent = localStorage.getItem('renderedContent');
            if (!courseData) {
                window.location.href = '/';
                return;
            }
            
            const contentContainer = document.getElementById('course-content');
            const tocList = document.getElementById('toc-list');
            
            // Render Markdown
            contentContainer.innerHTML = marked.parse(courseData);

            // Add official Google Search suggestions (Required by policy)
            if (renderedContent && renderedContent !== 'null') {
                const sourcesDiv = document.createElement('div');
                sourcesDiv.className = 'sources-section';
                sourcesDiv.innerHTML = `
                    <div class="sources-divider"></div>
                    <div id="google-search-suggestions-container"></div>
                `;
                contentContainer.appendChild(sourcesDiv);
                
                // Create Shadow DOM to isolate Google's generic classes like .container
                const container = document.getElementById('google-search-suggestions-container');
                const shadow = container.attachShadow({mode: 'open'});
                
                // Inject a small style fix to allow chips to wrap and not overflow
                const styleFix = `
                    <style>
                        .container { 
                            flex-wrap: wrap !important; 
                            height: auto !important;
                            padding: 8px 0 !important;
                        }
                        .carousel { 
                            white-space: normal !important; 
                            overflow: visible !important; 
                        }
                        .chip { 
                            margin-bottom: 8px !important; 
                        }
                    </style>
                `;
                shadow.innerHTML = styleFix + renderedContent;
            }
            
            // Generate TOC from h2 elements
            const headings = contentContainer.querySelectorAll('h2');
            if (headings.length === 0) {
                document.querySelector('.course-sidebar').style.display = 'none';
                document.querySelector('.course-layout').style.justifyContent = 'center';
            } else {
                headings.forEach((heading, index) => {
                    const id = 'section-' + index;
                    heading.id = id;
                    
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.href = '#' + id;
                    a.textContent = heading.textContent;
                    a.classList.add('toc-link');
                    
                    // Simple active state on click
                    a.addEventListener('click', () => {
                        document.querySelectorAll('.toc-link').forEach(l => l.classList.remove('active'));
                        a.classList.add('active');
                    });

                    li.appendChild(a);
                    tocList.appendChild(li);
                });
            }
        });
    </script>
</body>
</html>